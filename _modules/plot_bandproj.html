<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>plot_bandproj &#8212; HTESP v1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=75810a84" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css?v=79c92029" />
    <script src="../_static/documentation_options.js?v=e160b93e"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=blue-grey data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#_modules/plot_bandproj" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="HTESP v1.0 documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">HTESP v1.0 documentation</span>
          <span class="md-header-nav__topic"> plot_bandproj </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">HTESP v1.0 documentation</a></li>
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">Module code</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="HTESP v1.0 documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="HTESP v1.0 documentation">HTESP v1.0 documentation</a>
  </label>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
  <ul class="md-nav__list" data-md-scrollfix="">
    
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <h1 id="modules-plot-bandproj--page-root">Source code for plot_bandproj</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">"""</span>
<span class="sd">Script to process projection data</span>
<span class="sd">"""</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.io.pwscf</span><span class="w"> </span><span class="kn">import</span> <span class="n">PWInput</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.io.vasp.sets</span><span class="w"> </span><span class="kn">import</span> <span class="n">Incar</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">structure</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">check_json</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot</span>

<div class="viewcode-block" id="PROCARProcessor">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.PROCARProcessor">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PROCARProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    A class to process PROCAR file and extract band information.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - procar_file (str): Path to the PROCAR file.</span>
<span class="sd">    - band_file (str): Path to the band file.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    - nkpoint (int): Number of k-points.</span>
<span class="sd">    - nband (int): Number of bands.</span>
<span class="sd">    - nion (int): Number of ions.</span>
<span class="sd">    - ncol (int): Number of columns in the PROCAR data.</span>
<span class="sd">    - col (list): List of column labels.</span>
<span class="sd">    - data (numpy.ndarray): Processed PROCAR data.</span>
<span class="sd">    - nspin (int): Number of spin channels.</span>
<span class="sd">    - elements (list): List of elements parsed from structure file.</span>
<span class="sd">    - nkpoint_extra (int): Additional k-points in PROCAR file not in band file.</span>

<span class="sd">    Methods:</span>
<span class="sd">    - write_band_orbital(orb): Writes band orbital data to the specified file.</span>
<span class="sd">    - write_band_element(elm): Writes band element data to the specified file.</span>
<span class="sd">    - extract_data(elm, orb): Extracts data for a specific element and orbital.</span>
<span class="sd">    - extract_data_2(elm, orb): Extracts data for a specific element and orbital, summing over suborbitals.</span>
<span class="sd">    - print_info(): Prints available options for elements and orbitals.</span>
<span class="sd">    - clean(): Cleans up temporary files created during processing.</span>

<span class="sd">    Example:</span>
<span class="sd">    ```python</span>
<span class="sd">    # Instantiate PROCARProcessor</span>
<span class="sd">    &gt;&gt;&gt; procar_processor = PROCARProcessor("PROCAR", "BANDS")</span>

<span class="sd">    # Print available options</span>
<span class="sd">    &gt;&gt;&gt; procar_processor.print_info()</span>

<span class="sd">    # Extract data for a specific element and orbital</span>
<span class="sd">    &gt;&gt;&gt; procar_processor.extract_data('Fe', 's')</span>

<span class="sd">    # Write band orbital data to a file</span>
<span class="sd">    &gt;&gt;&gt; procar_processor.write_band_orbital('s')</span>

<span class="sd">    # Write band element data to a file</span>
<span class="sd">    &gt;&gt;&gt; procar_processor.write_band_element('Fe')</span>

<span class="sd">    # Clean up temporary files</span>
<span class="sd">    &gt;&gt;&gt; procar_processor.clean()</span>
<span class="sd">    ```</span>
<span class="sd">    """</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">procar_file</span><span class="p">,</span> <span class="n">band_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize PROCARProcessor with the provided PROCAR file and band file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - procar_file (str): Path to the PROCAR file.</span>
<span class="sd">        - band_file (str): Path to the band file.</span>
<span class="sd">        """</span>
        <span class="c1"># Assign the provided file paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">procar_file</span> <span class="o">=</span> <span class="n">procar_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">band_file</span> <span class="o">=</span> <span class="n">band_file</span>
        <span class="c1"># Parse header information from the band file and assign to attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nkpoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nband</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nion</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_procar_header</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_file</span><span class="p">)</span>
        <span class="c1"># Parse data from the PROCAR file and assign to attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_procar_data</span><span class="p">()</span>
        <span class="c1"># Parse structure information and assign to elements attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_structure</span><span class="p">()</span>
        <span class="c1"># Initialize additional k-points attribute</span>
        <span class="c1"># Useful for METAGGA/Hybrid calculations with 2 sets of k-mesh in KPOINTS file</span>
        <span class="c1"># uniform k-mesh and high-symmetry k-mesh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nkpoint_extra</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_procar_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">band_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Parse header information from the PROCAR file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - band_file (str): Path to the band file.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - nkpoint (int): Number of k-points.</span>
<span class="sd">        - nband (int): Number of bands.</span>
<span class="sd">        - nion (int): Number of ions.</span>
<span class="sd">        - ncol (int): Number of columns in the PROCAR data.</span>
<span class="sd">        - col (list): List of column labels.</span>
<span class="sd">        """</span>
        <span class="c1"># Read PROCAR file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">procar_file</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">procar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="c1"># Determine number of columns</span>
        <span class="n">ncol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">procar</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">procar</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Load band file to get number of k-points</span>
        <span class="n">orig_band</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_file</span><span class="p">)</span>
        <span class="n">nkpoint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">orig_band</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># Extract total number of k-points</span>
        <span class="n">nkpoint_total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">procar</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">":"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nkpoint_extra</span> <span class="o">=</span> <span class="n">nkpoint_total</span> <span class="o">-</span> <span class="n">nkpoint</span>
        <span class="c1"># Extract number of bands and ions</span>
        <span class="n">nband</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">procar</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">":"</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">nion</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">procar</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">":"</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># Calculate number of skipped lines for MGGA/Hybrid calculations</span>
        <span class="c1"># with 2 sets of k-points in KPOINTS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nband</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nkpoint_extra</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nkpoint</span><span class="p">,</span> <span class="n">nband</span><span class="p">,</span> <span class="n">nion</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">col</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Parse structure information from the POSCAR file.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - elements (list): List of element symbols.</span>
<span class="sd">        """</span>
        <span class="c1"># Load structure from POSCAR file</span>
        <span class="n">struc</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">"POSCAR"</span><span class="p">)</span>
        <span class="c1"># Extract element symbols</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">struc</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elm</span><span class="o">.</span><span class="n">species_string</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">elements</span>

<div class="viewcode-block" id="PROCARProcessor.print_info">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.PROCARProcessor.print_info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">print_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Print available options for elements and orbitals.</span>
<span class="sd">        """</span>
        <span class="c1"># Find unique elements</span>
        <span class="n">unique_elements</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">))</span>
        <span class="n">orbital_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"p"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">]</span>
        <span class="c1"># Print information</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Available options: elements </span><span class="si">{</span><span class="n">unique_elements</span><span class="si">}</span><span class="s2">, orbitals </span><span class="si">{</span><span class="n">orbital_names</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span></div>


<div class="viewcode-block" id="PROCARProcessor.clean">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.PROCARProcessor.clean">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Clean up temporary files created during processing.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">clean_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">-*.dat.gnu"</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">clean_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file_</span> <span class="ow">in</span> <span class="n">clean_files</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">"rm </span><span class="si">{</span><span class="n">file_</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_procar_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Parse data from the PROCAR file.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - data (numpy.ndarray): Processed PROCAR data.</span>
<span class="sd">        - nspin (int): Number of spin channels.</span>
<span class="sd">        """</span>
        <span class="c1"># Load INCAR file to determine spin configuration</span>
        <span class="n">incar</span> <span class="o">=</span> <span class="n">Incar</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">"INCAR"</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">'LSORBIT'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">incar</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">incar</span><span class="p">[</span><span class="s1">'LSORBIT'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">'ISPIN'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">incar</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">incar</span><span class="p">[</span><span class="s1">'ISPIN'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="s1">'LNONCOLLINEAR'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">incar</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">incar</span><span class="p">[</span><span class="s1">'LNONCOLLINEAR'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">incar</span><span class="p">[</span><span class="s1">'LSORBIT'</span><span class="p">]</span> <span class="ow">or</span> <span class="n">incar</span><span class="p">[</span><span class="s1">'LNONCOLLINEAR'</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="n">incar</span><span class="p">[</span><span class="s1">'ISPIN'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">incar</span><span class="p">[</span><span class="s1">'LNONCOLLINEAR'</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Read PROCAR file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">procar_file</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">procar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="c1"># Initialize ncount variable</span>
        <span class="n">ncount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Write processed PROCAR data to a temporary file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"procar_process.txt"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">procar_write</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="c1"># Loop over lines in PROCAR file</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">procar</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s1">'ion      s'</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="c1"># Check if the line is within the range to skip</span>
                        <span class="k">if</span> <span class="n">ncount</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nion</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nspin</span><span class="p">):</span>
                                <span class="n">procar_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">procar</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">ncount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">len_s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">procar</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">procar_up</span> <span class="o">=</span> <span class="n">procar</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">len_s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">procar_dn</span> <span class="o">=</span> <span class="n">procar</span><span class="p">[</span><span class="n">len_s</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
                <span class="c1"># Loop over lines in PROCAR file for spin-polarized calculation</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">procar_up</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s1">'ion      s'</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ncount</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nion</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                                <span class="n">procar_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">procar_up</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">ncount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">ncount</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">procar_dn</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s1">'ion      s'</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ncount</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nion</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                                <span class="n">procar_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">procar_dn</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">ncount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Read processed PROCAR data from temporary file</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s2">"procar_process.txt"</span><span class="p">)</span>
        <span class="c1"># Reshape data according to spin configuration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nspin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nkpoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nband</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nion</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nkpoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nband</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nion</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span><span class="p">)</span>
        <span class="c1"># For noncollinear calculation, select only the first spin channel</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">,:,:]</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span>
        <span class="c1">#return data.reshape(self.nkpoint, self.nband, self.nspin, self.nion+1, self.ncol)</span>

<div class="viewcode-block" id="PROCARProcessor.extract_data">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.PROCARProcessor.extract_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">elm</span><span class="p">,</span><span class="n">orb</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Extract data for a specific element and orbital.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - elm (str): Element symbol.</span>
<span class="sd">        - orb (str): Orbital type.</span>
<span class="sd">        """</span>
        <span class="c1"># To Do: Handle for ISPIN = 2 only</span>
        <span class="c1"># Find indices of the orbital</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">find_all_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>
        <span class="c1"># Extract subdata based on spin configuration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">subdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,:,:,</span><span class="n">find_all_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span><span class="n">elm</span><span class="p">),</span><span class="n">indices</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,:,</span><span class="n">find_all_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span><span class="n">elm</span><span class="p">),</span><span class="n">indices</span><span class="p">]</span>
        <span class="c1"># Write extracted data to a file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">orb</span><span class="si">}</span><span class="s2">.dat.gnu"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_procar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nband</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">subdata_iband</span> <span class="o">=</span> <span class="n">subdata</span><span class="p">[:,:,</span><span class="n">i</span><span class="p">,:]</span>
                    <span class="n">subdata_iband</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">subdata_iband</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">subdata_iband</span> <span class="o">=</span> <span class="n">subdata</span><span class="p">[:,</span><span class="n">i</span><span class="p">,:]</span>
                    <span class="n">subdata_iband</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">subdata_iband</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nkpoint</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">procar_jband</span> <span class="o">=</span> <span class="n">subdata_iband</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span>
                        <span class="n">write_procar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">procar_jband</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">procar_jband</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span>  <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">procar_jband</span> <span class="o">=</span> <span class="n">subdata_iband</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="n">write_procar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">procar_jband</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
                <span class="n">write_procar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></div>

<div class="viewcode-block" id="PROCARProcessor.extract_data_2">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.PROCARProcessor.extract_data_2">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_data_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">elm</span><span class="p">,</span><span class="n">orb</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Extract data for a specific element and orbital, summing over suborbitals.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - elm (str): Element symbol.</span>
<span class="sd">        - orb (str): Orbital type.</span>
<span class="sd">        """</span>
        <span class="c1"># Determine suborbitals for each orbital</span>
        <span class="k">if</span> <span class="n">orb</span> <span class="o">==</span> <span class="s1">'p'</span><span class="p">:</span>
            <span class="n">orb_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'px'</span><span class="p">,</span> <span class="s1">'py'</span><span class="p">,</span> <span class="s1">'pz'</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">orb</span> <span class="o">==</span> <span class="s1">'d'</span><span class="p">:</span>
            <span class="n">orb_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'dxy'</span><span class="p">,</span> <span class="s1">'dyz'</span><span class="p">,</span> <span class="s1">'dxz'</span><span class="p">,</span> <span class="s1">'dz2'</span><span class="p">,</span> <span class="s1">'x2-y2'</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Supports p or d</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="c1"># Extract data for each suborbital</span>
        <span class="k">for</span> <span class="n">orbi</span> <span class="ow">in</span> <span class="n">orb_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extract_data</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span><span class="n">orbi</span><span class="p">)</span>
        <span class="n">data0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">orb_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.dat.gnu"</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data0</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data0</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Sum data over suborbitals</span>
        <span class="k">for</span> <span class="n">orbi</span> <span class="ow">in</span> <span class="n">orb_list</span><span class="p">:</span>
            <span class="n">data_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">orbi</span><span class="si">}</span><span class="s2">.dat.gnu"</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">data_i</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">data_i</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># Save summed data to a file</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">orb</span><span class="si">}</span><span class="s2">.dat.gnu"</span><span class="p">,</span><span class="n">data</span><span class="p">)</span></div>


<div class="viewcode-block" id="PROCARProcessor.write_band_orbital">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.PROCARProcessor.write_band_orbital">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_band_orbital</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orb</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Write orbital data to the specified file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - output_file (str): Path to the output file.</span>
<span class="sd">        """</span>
        <span class="c1"># Open file for writing orbital data</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">orb</span><span class="si">}</span><span class="s2">.dat.gnu"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_procar</span><span class="p">:</span>
            <span class="c1"># Loop over bands</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nband</span><span class="p">):</span>
                <span class="c1"># Extract data for the current band and orbital</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">procar_iband</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nion</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">ncol</span><span class="p">]</span>
                    <span class="n">procar_iband</span> <span class="o">=</span> <span class="n">procar_iband</span><span class="p">[:,</span> <span class="p">:,</span><span class="n">find_all_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">,</span><span class="n">orb</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">procar_iband</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nion</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">ncol</span><span class="p">]</span>
                    <span class="n">procar_iband</span> <span class="o">=</span> <span class="n">procar_iband</span><span class="p">[:,</span> <span class="n">find_all_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">,</span><span class="n">orb</span><span class="p">)]</span>
                <span class="c1"># Loop over k-points</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nkpoint</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="c1">#procar_jband = procar_iband[j]</span>
                        <span class="n">write_procar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">procar_jband</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">procar_jband</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">procar_jband</span> <span class="o">=</span> <span class="n">procar_iband</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">write_procar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">procar_jband</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
                <span class="n">write_procar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></div>


<div class="viewcode-block" id="PROCARProcessor.write_band_element">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.PROCARProcessor.write_band_element">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_band_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elm</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Write element data to the specified file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - output_file (str): Path to the output file.</span>
<span class="sd">        """</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">.dat.gnu"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_procar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nband</span><span class="p">):</span>
                <span class="c1"># Extract data for the current band and element</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">procar_iband</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">find_all_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span><span class="n">elm</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">procar_iband</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">procar_iband</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">procar_iband</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">find_all_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span><span class="n">elm</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">procar_iband</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">procar_iband</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nkpoint</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nspin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="c1">#procar_jband = procar_iband[j]</span>
                        <span class="n">write_procar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">procar_jband</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">procar_jband</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">procar_jband</span> <span class="o">=</span> <span class="n">procar_iband</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="n">write_procar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">procar_jband</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
                <span class="n">write_procar</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="find_all_indices">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.find_all_indices">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_all_indices</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Find all indices of a specific element in a list.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - lst (list): List to search.</span>
<span class="sd">    - element (str): Element to find.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - indices (list): List of indices where the element is found.</span>
<span class="sd">    """</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">indices</span></div>



<div class="viewcode-block" id="DataProcessor">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.DataProcessor">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DataProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    A class to process projection data in "proj.out*" format from QE calculations.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        projdata (str): The projection data.</span>
<span class="sd">        nkpoint (int): The number of k-points.</span>
<span class="sd">        nband (int): The number of bands.</span>
<span class="sd">        nrow (int): The number of rows in the data.</span>
<span class="sd">        dict_ (dict): A dictionary for storing projection data.</span>
<span class="sd">        dict_2 (dict): Another dictionary for storing data with keys</span>
<span class="sd">                       as elements and values as list storing orbital info.</span>
<span class="sd">        dict_1 (dict): Similar to dict_1, but only with useful orbital info.</span>
<span class="sd">        ref_data (str): Reference data to initialize numpy array.</span>
<span class="sd">        proj_dict (dict): Dictionary for projection data.</span>
<span class="sd">        final_dict (dict): Dictionary for final data for unique element-orbital combination.</span>
<span class="sd">        In a compound like A2B3, when combining orbital contributions for elements A and B,</span>
<span class="sd">        we need to consider the stoichiometry.</span>
<span class="sd">        For example, if we're summing contributions from the pz orbital:</span>

<span class="sd">        - For element A, the contribution from the pz orbital should be summed 2 times</span>
<span class="sd">          (since there are 2 A atoms).</span>
<span class="sd">        - For element B, the contribution from the pz orbital should be summed 3 times</span>
<span class="sd">          (since there are 3 B atoms).</span>
<span class="sd">        This ensures that the overall contribution is correctly weighted by the number</span>
<span class="sd">        of atoms of each element in the compound.</span>
<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; processor = DataProcessor(structure_file="scf.in", proj_file="proj.out*")</span>
<span class="sd">    """</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure_file</span><span class="o">=</span><span class="s2">"scf.in"</span><span class="p">,</span> <span class="n">proj_file</span><span class="o">=</span><span class="s2">"proj.out*"</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize DataProcessor with structure and projection files.</span>

<span class="sd">        Args:</span>
<span class="sd">            structure_file (str): The filename of the structure input file.</span>
<span class="sd">            proj_file (str): The filename pattern for the projection output files.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projdata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nkpoint</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nband</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proj_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_proj_file</span><span class="p">(</span><span class="n">structure_file</span><span class="p">,</span> <span class="n">proj_file</span><span class="p">)</span>

<div class="viewcode-block" id="DataProcessor.convert_gnu">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.DataProcessor.convert_gnu">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">convert_gnu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Convert data file to GNU plot format.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): The filename of the data file to be converted.</span>
<span class="sd">        """</span>
        <span class="c1"># Load data from the file as output of projwfc.x format</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="c1"># Extract the third column of the data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># Reshape the data into a 2D array based on nkpoint and nband</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nkpoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nband</span><span class="p">)</span>
        <span class="c1"># Write the data to a GNU plot format file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.gnu"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_gnu</span><span class="p">:</span>
            <span class="c1"># Loop over each band</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">datak</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
                <span class="c1"># Write data for each k-point in the band</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">datak</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">write_gnu</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datak</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
                <span class="c1"># Add a newline after writing data for each band</span>
                <span class="n">write_gnu</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">combine_orbital</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">orb</span><span class="p">,</span> <span class="n">if_gnu</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Combine projection data for a specific orbital and write to files.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): Key for accessing data in dictionaries.</span>
<span class="sd">            orb (str): Orbital type to combine.</span>
<span class="sd">            if_gnu (bool): Whether to convert the combined data to GNU plot format.</span>
<span class="sd">        """</span>
        <span class="c1"># Write projection data for each element/orbital combination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_proj_elm_orbi</span><span class="p">()</span>
        <span class="c1"># Iterate over each orbital name in the final_dict for the given key</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
            <span class="c1"># Retrieve projection array for the current orbital name</span>
            <span class="n">proj_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># Save projection array to a file with appropriate formatting</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">,</span><span class="n">proj_array</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s1">'</span><span class="si">%d</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="si">%d</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="si">%.4f</span><span class="s1">'</span><span class="p">])</span>
            <span class="c1"># Convert to GNU plot format if specified</span>
            <span class="k">if</span> <span class="n">if_gnu</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">convert_gnu</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">)</span>
        <span class="c1"># Combine data for the specified orbital type</span>
        <span class="n">sdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nrow</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">sfile</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">-*</span><span class="si">{</span><span class="n">orb</span><span class="si">}</span><span class="s2">*.dat"</span><span class="p">)</span>
        <span class="n">s0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">sfile</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">sdata</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s0</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sdata</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s0</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">len_s</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sfile</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_s</span><span class="p">):</span>
            <span class="n">idata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">sfile</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="c1">#sdata[:,2] += idata[:,2] / len_s</span>
            <span class="n">sdata</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">idata</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">orb</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">,</span> <span class="n">sdata</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s1">'</span><span class="si">%d</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="si">%d</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="si">%.4f</span><span class="s1">'</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_gnu</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">orb</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">)</span>

<div class="viewcode-block" id="DataProcessor.clean">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.DataProcessor.clean">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">delete_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Deleting file</span>
<span class="sd">        """</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">"rm </span><span class="si">{</span><span class="n">delete_file</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_proj_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure_file</span><span class="p">,</span> <span class="n">proj_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Parse projection file to extract relevant data.</span>

<span class="sd">        Args:</span>
<span class="sd">            structure_file (str): The filename of the structure input file.</span>
<span class="sd">            proj_file (str): The filename pattern for the projection output files.</span>
<span class="sd">        """</span>
        <span class="c1"># Get the elements from the structure file</span>
        <span class="n">struc</span> <span class="o">=</span> <span class="n">PWInput</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">structure_file</span><span class="p">)</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">element</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">struc</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">element</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">elm</span><span class="p">))</span>
        <span class="c1"># To Do: For spin pol</span>
        <span class="c1">#if spin == 2:</span>
        <span class="c1">#projfile = glob.glob(proj_file)</span>
        <span class="c1"># Find the projection file matching the pattern</span>
        <span class="n">projfile</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">proj_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#if spin == 2:</span>
        <span class="c1"># Add outer loop</span>
        <span class="c1">#for proj in projfile:</span>
        <span class="c1"># Extract orbital informations for each element from the projection file</span>
        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">element</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">"grep </span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">projfile</span><span class="si">}</span><span class="s2"> | sed '1d' &gt; proj-</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">)</span>
        <span class="c1"># Read the proj-{elm}.dat file and extract necessary information</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">projfile</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">read_projfile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">projdata</span> <span class="o">=</span> <span class="n">read_projfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nkpoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nband</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projdata</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nkpoint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nkpoint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nband</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nband</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nkpoint</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nband</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_1</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># For each element, store data, line with orbital names in short form, and full form</span>
        <span class="c1"># as lists</span>
        <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">element</span><span class="p">:</span>
            <span class="n">sublist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">typelist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">namelist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">"proj-</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">read_elm</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">read_elm</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                    <span class="n">namelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">linex</span> <span class="o">=</span> <span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
                    <span class="n">typelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linex</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projdata</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">projdata</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                            <span class="n">sublist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_</span><span class="p">[</span><span class="n">elm</span><span class="p">]</span> <span class="o">=</span> <span class="n">sublist</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_1</span><span class="p">[</span><span class="n">elm</span><span class="p">]</span> <span class="o">=</span> <span class="n">typelist</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_2</span><span class="p">[</span><span class="n">elm</span><span class="p">]</span> <span class="o">=</span> <span class="n">namelist</span>

<div class="viewcode-block" id="DataProcessor.write_proj_elm_orbi">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.DataProcessor.write_proj_elm_orbi">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_proj_elm_orbi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Write projection data for each element/orbital combination.</span>
<span class="sd">        """</span>
        <span class="c1"># Iterate over each element key</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">nameval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">namecount</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">nameval</span><span class="p">)</span>
            <span class="n">lenv</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">dict_value</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c1"># Iterate over each index and value pair</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">ncount</span> <span class="o">=</span> <span class="n">namecount</span><span class="p">[</span><span class="n">nameval</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="n">subname</span> <span class="o">=</span> <span class="n">nameval</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="c1"># Define the orbital name</span>
                <span class="k">if</span> <span class="s2">"S"</span> <span class="ow">in</span> <span class="n">nameval</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">subname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s2">"P 1"</span> <span class="ow">in</span> <span class="n">nameval</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">subname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"z"</span>
                <span class="k">elif</span> <span class="s2">"P 2"</span> <span class="ow">in</span> <span class="n">nameval</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">subname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"x"</span>
                <span class="k">elif</span> <span class="s2">"P 3"</span> <span class="ow">in</span> <span class="n">nameval</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">subname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"y"</span>
                <span class="k">elif</span> <span class="s2">"D 1"</span> <span class="ow">in</span> <span class="n">nameval</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">subname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"z2"</span>
                <span class="k">elif</span> <span class="s2">"D 2"</span> <span class="ow">in</span> <span class="n">nameval</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">subname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"xz"</span>
                <span class="k">elif</span> <span class="s2">"D 3"</span> <span class="ow">in</span> <span class="n">nameval</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">subname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"yz"</span>
                <span class="k">elif</span> <span class="s2">"D 4"</span> <span class="ow">in</span> <span class="n">nameval</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">subname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"x2-y2"</span>
                <span class="k">elif</span> <span class="s2">"D 5"</span> <span class="ow">in</span> <span class="n">nameval</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">subname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"xy"</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="c1"># extract subdata from projection data</span>
                <span class="n">subdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projdata</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">idx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">subdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_to_numpy</span><span class="p">(</span><span class="n">subdata</span><span class="p">)</span>
                <span class="c1"># Update the subdata if it has more than one occurence for a given element type.</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dict_value</span><span class="p">:</span>
                    <span class="n">dict_value</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="n">subdata</span>
                    <span class="c1">#dict_value[name] += subdata / ncount</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dict_value</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">subdata</span>
                    <span class="c1">#dict_value[name] = subdata / ncount</span>
                <span class="c1"># Similar to dict_1, but with new defined orbital names.</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj_dict</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">proj_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">proj_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># Similar to dict_, but with summed over similar atom type.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_value</span></div>


<div class="viewcode-block" id="DataProcessor.print_info">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.DataProcessor.print_info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">print_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Printing available options</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_proj_elm_orbi</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Other Available options: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">proj_dict</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataProcessor.extract_data">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.DataProcessor.extract_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">elm</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Extract projection data for a specific element and orbital and save it to a file.</span>

<span class="sd">        Args:</span>
<span class="sd">            elm (str): Element for which projection data is extracted.</span>
<span class="sd">            name (str): Name of the orbital for which projection data is extracted.</span>
<span class="sd">        """</span>
        <span class="c1"># Write projection data for each element/orbital combination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_proj_elm_orbi</span><span class="p">()</span>
        <span class="c1"># Retrieve projection array for the specified element and orbital</span>
        <span class="n">proj_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_dict</span><span class="p">[</span><span class="n">elm</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
        <span class="c1"># Save projection array to a file with appropriate formatting</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">,</span> <span class="n">proj_array</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s1">'</span><span class="si">%d</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="si">%d</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="si">%.4f</span><span class="s1">'</span><span class="p">])</span>
        <span class="c1"># Convert to GNU plot format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_gnu</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataProcessor.extract_data_2">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.DataProcessor.extract_data_2">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_data_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">elm</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Extract projection data for a specific element and orbital and save it to a file,</span>
<span class="sd">        while summing contributions from multiple suborbitals if applicable.</span>
<span class="sd">        Here, orbitals are "p", "d" instead of suborbitals "px", "py", "pz", etc.</span>

<span class="sd">        Args:</span>
<span class="sd">            elm (str): Element for which projection data is extracted.</span>
<span class="sd">            name (str): Name of the orbital or orbital type for which projection data is extracted.</span>
<span class="sd">        """</span>
        <span class="c1"># Determine the orbital type and list of orbitals to extract</span>
        <span class="n">norb</span><span class="p">,</span><span class="n">lorb</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lorb</span> <span class="o">==</span> <span class="s1">'p'</span><span class="p">:</span>
            <span class="n">orb_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'px'</span><span class="p">,</span> <span class="s1">'py'</span><span class="p">,</span> <span class="s1">'pz'</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">lorb</span> <span class="o">==</span> <span class="s1">'d'</span><span class="p">:</span>
            <span class="n">orb_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'dxy'</span><span class="p">,</span> <span class="s1">'dxz'</span><span class="p">,</span> <span class="s1">'dyz'</span><span class="p">,</span> <span class="s1">'dz2'</span><span class="p">,</span> <span class="s1">'x2-y2'</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orb_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="c1"># Extract projection data for each orbital in the list</span>
        <span class="k">for</span> <span class="n">orbi</span> <span class="ow">in</span> <span class="n">orb_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extract_data</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span> <span class="n">norb</span><span class="o">+</span><span class="n">orbi</span><span class="p">)</span>
        <span class="c1"># Combine data from multiple suborbitals if applicable</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">*.dat"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_data</span> <span class="o">=</span> <span class="n">file_</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">newdata</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s1">'</span><span class="si">%d</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="si">%d</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="si">%.4f</span><span class="s1">'</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_gnu</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">)</span></div>



<div class="viewcode-block" id="DataProcessor.combine_element">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.DataProcessor.combine_element">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">combine_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">elm</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Combine projection data for a specific element and save it to a file.</span>

<span class="sd">        Args:</span>
<span class="sd">            elm (str): Element for which projection data is combined.</span>
<span class="sd">        """</span>
        <span class="c1"># Find files matching the element pattern</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">-*.dat"</span><span class="p">)</span>
        <span class="c1"># Iterate over files and combine data</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_data</span> <span class="o">=</span> <span class="n">file_</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">newdata</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s1">'</span><span class="si">%d</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="si">%d</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="si">%.4f</span><span class="s1">'</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_gnu</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataProcessor.combine_orbital">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.DataProcessor.combine_orbital">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">combine_orbital</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">orb</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Combine projection data for a specific orbital and save it to a file.</span>

<span class="sd">        Args:</span>
<span class="sd">            orb (str): Orbital type for which projection data is combined.</span>
<span class="sd">        """</span>
        <span class="c1"># Find files matching the orbital pattern</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">"*-</span><span class="si">{</span><span class="n">orb</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">)</span>
        <span class="c1"># Iterate over files and combine data</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_data</span> <span class="o">=</span> <span class="n">file_</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">newdata</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">orb</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s1">'</span><span class="si">%d</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="si">%d</span><span class="s1">'</span><span class="p">,</span> <span class="s1">'</span><span class="si">%.4f</span><span class="s1">'</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_gnu</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">orb</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataProcessor.convert_to_numpy">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.DataProcessor.convert_to_numpy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">convert_to_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Convert input data to a NumPy array.</span>

<span class="sd">        Args:</span>
<span class="sd">            input_data (list): List of strings representing data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            numpy.ndarray: NumPy array containing the converted data.</span>
<span class="sd">        """</span>
        <span class="c1"># Remove newline characters and convert each string to a list of floats</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">]</span>
        <span class="c1"># Convert the list of lists to a NumPy array</span>
        <span class="n">np_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np_array</span></div>
</div>


<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../plot_bandproj.html#plot_bandproj.main">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Main function to execute the program</span>
<span class="sd">    """</span>
    <span class="c1"># Loading configuration file and compound name</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="n">config</span><span class="p">()</span>
    <span class="n">comp</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Looking for structure file</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">'scf.in'</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">'../relax/scf.in'</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">'POSCAR'</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">'POSCAR'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No scf.in and POSCAR exists</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="c1"># Reading parameters from config.json file</span>
    <span class="n">plot_info</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s2">"plot"</span><span class="p">][</span><span class="s2">"bandproj"</span><span class="p">]</span>
    <span class="n">proj_type</span> <span class="o">=</span> <span class="n">plot_info</span><span class="p">[</span><span class="s2">"proj_type"</span><span class="p">]</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="n">plot_info</span><span class="p">[</span><span class="s2">"proj"</span><span class="p">]</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">plot_info</span><span class="p">[</span><span class="s2">"colormap"</span><span class="p">]</span>
    <span class="n">dft</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s2">"download"</span><span class="p">][</span><span class="s2">"inp"</span><span class="p">][</span><span class="s2">"calc"</span><span class="p">]</span>
    <span class="c1"># If DFT is "VASP"</span>
    <span class="k">if</span> <span class="n">dft</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"VASP"</span><span class="p">,</span> <span class="s2">"vasp"</span><span class="p">):</span>
        <span class="c1"># Initialize PROCARProcessor instance</span>
        <span class="n">procar_processor</span> <span class="o">=</span> <span class="n">PROCARProcessor</span><span class="p">(</span><span class="s2">"PROCAR"</span><span class="p">,</span><span class="s2">"band.dat"</span><span class="p">)</span>
        <span class="c1"># Clean if there exists projection files</span>
        <span class="n">procar_processor</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="c1"># Print available options</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"projection type: </span><span class="si">{</span><span class="n">proj_type</span><span class="si">}</span><span class="s2">, projections: </span><span class="si">{</span><span class="n">proj</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">procar_processor</span><span class="o">.</span><span class="n">print_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">proj_type</span> <span class="o">==</span> <span class="s2">"element"</span><span class="p">:</span>
            <span class="c1"># For element mode, loop over list of elements</span>
            <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">proj</span><span class="p">:</span>
                <span class="c1"># Write projection files for each elements</span>
                <span class="n">procar_processor</span><span class="o">.</span><span class="n">write_band_element</span><span class="p">(</span><span class="n">elm</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">proj_type</span> <span class="o">==</span> <span class="s2">"orbital"</span><span class="p">:</span>
            <span class="c1"># Similar for orbital mode</span>
            <span class="k">for</span> <span class="n">orb</span> <span class="ow">in</span> <span class="n">proj</span><span class="p">:</span>
                <span class="n">procar_processor</span><span class="o">.</span><span class="n">write_band_orbital</span><span class="p">(</span><span class="n">orb</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">proj_type</span> <span class="o">==</span> <span class="s2">"element-orbital"</span><span class="p">:</span>
            <span class="c1"># For element-orbital mode, dictionary of key, value pair is used.</span>
            <span class="c1"># Keys are elements, and values are either single orbital ("p" or "px")</span>
            <span class="c1"># or list of orbitals (could be ["p", "d"] or ["px", "py", ...])</span>
            <span class="c1"># Doesn't work for f-orbitals for now.</span>
            <span class="k">for</span> <span class="n">elm_orb</span> <span class="ow">in</span> <span class="n">proj</span><span class="p">:</span>
                <span class="n">elm</span> <span class="o">=</span> <span class="n">elm_orb</span>
                <span class="n">orb</span> <span class="o">=</span> <span class="n">proj</span><span class="p">[</span><span class="n">elm</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orb</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">orbi</span> <span class="ow">in</span> <span class="n">orb</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">orbi</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'p'</span><span class="p">,</span> <span class="s1">'d'</span><span class="p">]:</span>
                            <span class="n">procar_processor</span><span class="o">.</span><span class="n">extract_data_2</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span><span class="n">orbi</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">procar_processor</span><span class="o">.</span><span class="n">extract_data</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span><span class="n">orbi</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">orb</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'p'</span><span class="p">,</span> <span class="s1">'d'</span><span class="p">]:</span>
                        <span class="n">procar_processor</span><span class="o">.</span><span class="n">extract_data_2</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">procar_processor</span><span class="o">.</span><span class="n">extract_data</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">dft</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"QE"</span><span class="p">,</span> <span class="s2">"qe"</span><span class="p">):</span>
        <span class="c1"># For spin polarized we may need to loop over up and down spin channel.</span>
        <span class="c1"># Initialize DataProcessor instance for QE proj.out* file.</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="n">DataProcessor</span><span class="p">(</span><span class="n">structure_file</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
        <span class="c1"># Print available options</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"projection type: </span><span class="si">{</span><span class="n">proj_type</span><span class="si">}</span><span class="s2">, projections: </span><span class="si">{</span><span class="n">proj</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">dp</span><span class="o">.</span><span class="n">print_info</span><span class="p">()</span>
        <span class="c1"># Clean files if already present</span>
        <span class="n">clean_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*.dat"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file_</span> <span class="ow">in</span> <span class="n">clean_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s2">.dat"</span><span class="p">:</span>
                <span class="n">dp</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>
        <span class="n">clean_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*.dat.gnu"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file_</span> <span class="ow">in</span> <span class="n">clean_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s2">.dat.gnu"</span><span class="p">:</span>
                <span class="n">dp</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>
        <span class="c1"># First creates all keys/values pair data</span>
        <span class="c1"># and combine according to plot_type.</span>
        <span class="k">if</span> <span class="n">proj_type</span> <span class="o">==</span> <span class="s2">"element"</span><span class="p">:</span>
            <span class="c1"># Creates projection files based on elements</span>
            <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">proj</span><span class="p">:</span>
                <span class="n">proj_list</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">proj_dict</span><span class="p">[</span><span class="n">elm</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">projection</span> <span class="ow">in</span> <span class="n">proj_list</span><span class="p">:</span>
                    <span class="n">dp</span><span class="o">.</span><span class="n">extract_data</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span><span class="n">projection</span><span class="p">)</span>
                <span class="n">dp</span><span class="o">.</span><span class="n">combine_element</span><span class="p">(</span><span class="n">elm</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">projection</span> <span class="ow">in</span> <span class="n">proj_list</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">"rm </span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">projection</span><span class="si">}</span><span class="s2">.dat.gnu"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">proj_type</span> <span class="o">==</span> <span class="s2">"orbital"</span><span class="p">:</span>
            <span class="c1"># Creates projection files based on orbitals</span>
            <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">dp</span><span class="o">.</span><span class="n">proj_dict</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">projection</span> <span class="ow">in</span> <span class="n">proj</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">projection</span> <span class="ow">in</span> <span class="n">dp</span><span class="o">.</span><span class="n">proj_dict</span><span class="p">[</span><span class="n">elm</span><span class="p">]:</span>
                        <span class="n">dp</span><span class="o">.</span><span class="n">extract_data</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span><span class="n">projection</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">orb</span> <span class="ow">in</span> <span class="n">proj</span><span class="p">:</span>
                <span class="n">dp</span><span class="o">.</span><span class="n">combine_orbital</span><span class="p">(</span><span class="n">orb</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">dp</span><span class="o">.</span><span class="n">proj_dict</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">projection</span> <span class="ow">in</span> <span class="n">proj</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">projection</span> <span class="ow">in</span> <span class="n">dp</span><span class="o">.</span><span class="n">proj_dict</span><span class="p">[</span><span class="n">elm</span><span class="p">]:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">"rm </span><span class="si">{</span><span class="n">elm</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">projection</span><span class="si">}</span><span class="s2">.dat.gnu"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">proj_type</span> <span class="o">==</span> <span class="s2">"element-orbital"</span><span class="p">:</span>
            <span class="c1"># Creates projection files based on element-orbital combination</span>
            <span class="c1"># For element-orbital mode, dictionary of key, value pair is used.</span>
            <span class="c1"># Keys are elements, and values are either single orbital ("2p" or "2px")</span>
            <span class="c1"># or list of orbitals (could be ["2p", "3d"] or ["2px", "2py", ...])</span>
            <span class="c1"># Doesn't work for f-orbitals for now.</span>
            <span class="c1"># Unlike VASP, here one has to define 2p, 3d instead of p, d.</span>
            <span class="k">for</span> <span class="n">elm_orb</span> <span class="ow">in</span> <span class="n">proj</span><span class="p">:</span>
                <span class="n">elm</span> <span class="o">=</span> <span class="n">elm_orb</span>
                <span class="n">orb</span> <span class="o">=</span> <span class="n">proj</span><span class="p">[</span><span class="n">elm</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orb</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">orbi</span> <span class="ow">in</span> <span class="n">orb</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">dp</span><span class="o">.</span><span class="n">extract_data</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span><span class="n">orbi</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">dp</span><span class="o">.</span><span class="n">extract_data_2</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span><span class="n">orbi</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">dp</span><span class="o">.</span><span class="n">extract_data</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">dp</span><span class="o">.</span><span class="n">extract_data_2</span><span class="p">(</span><span class="n">elm</span><span class="p">,</span><span class="n">orb</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Either QE/qe or VASP/vasp allowed</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="c1"># Plot band structure with projections overlay.</span>
    <span class="c1">#color_maps = ['Reds', 'Blues', 'Greens', 'Purples', 'Greys', 'Oranges',</span>
    <span class="c1">#                  'YlOrBr', 'YlOrRd', 'OrRd', 'PuRd', 'RdPu', 'BuPu',</span>
    <span class="c1">#                  'GnBu', 'PuBu', 'YlGnBu', 'PuBuGn', 'BuGn', 'YlGn']</span>
    <span class="k">if</span> <span class="n">dft</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"VASP"</span><span class="p">,</span> <span class="s2">"vasp"</span><span class="p">):</span>
        <span class="n">proj_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*.dat.gnu"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"-----------------------------------</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Band file: </span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s2">.dat.gnu"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Processing PROCAR file</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"-----------------------------------</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">proj_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">proj_files</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">proj_file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s2">.dat.gnu"</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">proj_file</span><span class="p">)</span>
                <span class="n">plot</span><span class="p">(</span><span class="s2">"band"</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">comp</span><span class="p">,</span><span class="n">proj_file</span><span class="p">,</span><span class="n">procar_processor</span><span class="o">.</span><span class="n">nkpoint</span><span class="p">,</span><span class="n">colormap</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
                <span class="n">proj_name</span> <span class="o">=</span> <span class="n">proj_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">".dat.gnu"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">"mv </span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s2">-band.pdf </span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">proj_name</span><span class="si">}</span><span class="s2">-band.pdf"</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">dft</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"QE"</span><span class="p">,</span> <span class="s2">"qe"</span><span class="p">):</span>
        <span class="n">proj_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*.dat.gnu"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"-----------------------------------</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Band file: </span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s2">.dat.gnu"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Processing proj.out* file</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"-----------------------------------</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">proj_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">proj_files</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">proj_file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s2">.dat.gnu"</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">proj_file</span><span class="p">)</span>
                <span class="n">plot</span><span class="p">(</span><span class="s2">"band"</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">comp</span><span class="p">,</span><span class="n">proj_file</span><span class="p">,</span><span class="n">colormap</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
                <span class="n">proj_name</span> <span class="o">=</span> <span class="n">proj_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">".dat.gnu"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">"mv </span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s2">-band.pdf </span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">proj_name</span><span class="si">}</span><span class="s2">-band.pdf"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Only VASP/vasp or QE/qe options available</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2024, Niraj K Nepal.
              
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>